{
	"name": "DFEMPHIER",
	"properties": {
		"type": "MappingDataFlow",
		"typeProperties": {
			"sources": [
				{
					"dataset": {
						"referenceName": "AIA_AGENCY_EMP_HIER_DETAILS_HISTORY_PRD",
						"type": "DatasetReference"
					},
					"name": "DFEMPHIER"
				}
			],
			"sinks": [
				{
					"dataset": {
						"referenceName": "AIA_IMS_EMP_HIERARCHY_EXTRACTS_PRD",
						"type": "DatasetReference"
					},
					"name": "sinkemphierfile"
				}
			],
			"transformations": [],
			"scriptLines": [
				"source(output(",
				"          E2EIS_SEQ_NUMBER as long,",
				"          USER_ID as string,",
				"          FIRST_NAME as string,",
				"          LAST_NAME as string,",
				"          EMAIL_ADDRESS as string,",
				"          TERMINATION_FLAG as string,",
				"          DEPARTMENT_NAME as string,",
				"          NPN_GROUPING as string,",
				"          UPLINE_ID as string,",
				"          UPLINE_FIRST_NAME as string,",
				"          UPLINE_LAST_NAME as string,",
				"          LEVEL_SEQ as string,",
				"          AGENCY_ID as string,",
				"          RECORD_LOAD_DATE as date,",
				"          RECORD_LOADED_BY as string,",
				"          RECORD_DATA_SOURCE as string,",
				"          RECORD_FLAG_STATUS as string",
				"     ),",
				"     allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     isolationLevel: 'READ_UNCOMMITTED',",
				"     query: 'SELECT User_Id, \\n       First_Name, \\n       Last_Name, \\n       Email_Address, \\n       Termination_Flag, \\n       Department_Name, \\n       NPN_Grouping, \\n       Upline_Id,\\n       Upline_First_Name, \\n       Upline_Last_Name, \\n       Level_Seq, \\n       MAX(Record_Load_date) AS Max_Record_Load_date\\nFROM [AIA_102].[AIA_AGENCY_EMP_HIER_DETAILS_HISTORY] AS emp\\nWHERE NOT EXISTS (\\n    SELECT 1\\n    FROM [AIA_102].[AIA_AGENCY_PAYEE_DETAILS] AS payee\\n    WHERE payee.Employee_ID = emp.USER_ID\\n)\\nGROUP BY User_Id, \\n         First_Name, \\n         Last_Name, \\n         Email_Address, \\n         Termination_Flag, \\n         Department_Name, \\n         NPN_Grouping, \\n         Upline_Id,\\n         Upline_First_Name, \\n         Upline_Last_Name, \\n         Level_Seq',",
				"     format: 'query') ~> DFEMPHIER",
				"DFEMPHIER sink(allowSchemaDrift: true,",
				"     validateSchema: false,",
				"     input(",
				"          E2EIS_SEQ_NUMBER as string,",
				"          AGENCY_IDENTIFIER as string,",
				"          AGENT_ID as string,",
				"          AGENT_NPN as string,",
				"          AGENT_FULL_NAME as string,",
				"          PLAN_NAME as string,",
				"          PRODUCT as string,",
				"          CONTRACT_ID as string,",
				"          CONTRACT_MEMBER_COUNT as string,",
				"          MEMBER_RELATIONSHIP as string,",
				"          MEMBER_FIRST_NAME as string,",
				"          MEMBER_LAST_NAME as string,",
				"          MEMBER_DOB as string,",
				"          COUNTY_NAME as string,",
				"          AGENT_CONTRACT_START_DATE as string,",
				"          AGENT_CONTRACT_TERM_DATE as string,",
				"          EXCHANGE_INDICATOR as string,",
				"          MEMBER_PHONE_NUMBER as string,",
				"          MEMBER_EMAIL_ADDRESS as string,",
				"          MEMBER_FB_UID as string,",
				"          MWS_REGISTRATION as string,",
				"          PRODUCT_TYPE as string,",
				"          AGENT_STATUS as string,",
				"          REINSTATEMENT_INDICATOR as string,",
				"          MEMBER_AGE_IN_INDICATOR as string,",
				"          MEMBER_AGE_OUT_INDICATOR as string,",
				"          TOTAL_REWARDS_EARNED as string,",
				"          TOTAL_REWARDS_APPLIED_TO_PREMIUM as string,",
				"          TOTAL_REWARDS_APPLIED_TO_GIFT_CARD as string,",
				"          MEMBER_WELLNESS_ELIGIBILITY as string,",
				"          MEMBER_PARTICIPATION_WELLNESS_PROGRAM as string,",
				"          MEMBER_SPECIAL_ELIGIBILITY as string,",
				"          MEMBER_SPECIAL_PARTICIPATION as string,",
				"          MASTER_AGENCY_NAME as string,",
				"          MASTER_AGENCY_ID as string,",
				"          PRODUCT_ID as string,",
				"          MEMBER_PROVIDER_NAME as string,",
				"          PROVIDER_GROUP as string,",
				"          PCP_ASSIGNMENT as string,",
				"          BEST_AVAILABLE_ADDRESS as string,",
				"          BEST_AVAILABLE_ADDRESS_LINE_2 as string,",
				"          BEST_AVAILABLE_CITY_NAME as string,",
				"          BEST_AVAILABLE_STATE_NAME as string,",
				"          BEST_AVAILABLE_POSTAL_CODE as string,",
				"          COUNTY_CODE as string,",
				"          FFM_REG_STATUS as string,",
				"          CANCELLATION_REASON_CODE as string,",
				"          CANCELLATION_REASON as string,",
				"          APTC_EXPIRED_DAYS as string,",
				"          COVERAGE_EFFECTIVE_DATE as string,",
				"          COVERAGE_EXPIRATION_DATE as string,",
				"          MEMBER_ORIGINAL_EFFECTIVE_DATE as string,",
				"          METAL_LEVEL as string,",
				"          CONTRACT_STATUS as string,",
				"          PREMIUM_AMOUNT as string,",
				"          SCHEDULED_PAYMENT_DATE as string,",
				"          APTC_AMOUNT as string,",
				"          MEMBER_RESPONSIBILITY as string,",
				"          INCONSISTENCY_INDICATOR as string,",
				"          TOTAL_REWARDS_AVAILABLE_BALANCE as string,",
				"          CMS_CERT_STATUS as string,",
				"          ONBOARDING_INDICATOR as string,",
				"          SOURCE_SYSTEM as string,",
				"          SEGMENT as string,",
				"          AGENCY_ID as string,",
				"          RECORD_LOAD_DATE as string,",
				"          RECORD_LOADED_BY as string,",
				"          RECORD_DATA_SOURCE as string,",
				"          RECORD_FLAG_STATUS as string,",
				"          POLICY_ADDED_DATE as string,",
				"          POLICY_REMOVED_DATE as string,",
				"          POLICY_CANCELLED_DATE as string,",
				"          POLICY_REACTIVATION_DATE as string,",
				"          POLICY_RETENTION_DATE as string,",
				"          ADDS_MEMBER_COUNT as string,",
				"          CANCELS_MEMBER_COUNT as string,",
				"          ORIGINAL_POLICY_STATUS as string,",
				"          ACTIVITY_FLAG as string,",
				"          PERIOD_START_DATE as string,",
				"          PERIOD_END_DATE as string,",
				"          PERIOD_NAME as string,",
				"          PERIOD_DESCRIPTION as string,",
				"          BILL_STATUS as string,",
				"          POLICY_LAST_RECEIVED_DATE as string,",
				"          ALIGNED_AGENT_CODE as string,",
				"          ALIGNED_AGENT_NAME as string,",
				"          MAIN_UPLINE_NO as string,",
				"          MAIN_UPLINE_NAME as string,",
				"          GROUP_TEAM_SALES as string,",
				"          PAYEE_NAME as string,",
				"          WRTAGNT_COMMENTS as string,",
				"          IMS_TRANSACTION_ID as string",
				"     ),",
				"     partitionFileNames:['AIA_IMS_EMP_HIERARCHY_EXTRACTS_MMDDYYYY.csv'],",
				"     skipDuplicateMapInputs: true,",
				"     skipDuplicateMapOutputs: true,",
				"     partitionBy('hash', 1)) ~> sinkemphierfile"
			]
		}
	}
}